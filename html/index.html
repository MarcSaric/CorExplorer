<?php
require_once("db.php");
require_once("util.php");

head_section("CorEx Portal");
?>

<body>

<?php
$page_opts = array("","over","dset","search","how","dl","pub");
$page_lbls = array("","Overview","Datasets","Search","How-To","Download","Publications");
$page_pgs = array("welcome.html","overview.html","datasets.html","search.html","howto.html",
				"download.html","publications.html");
function headerbar()
{
	global $page_opts, $page_lbls, $page_pgs;
	$cur_opt = getval("opt","");

echo <<<END
<table cellpadding=0 cellspacing=0 width="100%" 
		style="background-color:#f5f5f5;border-left:1px solid #d5d5d5;border-right:1px solid #d5d5d5">
	<tr>
		<td align="left">
	<table cellpadding=0 cellspacing=0 style="background-color:#f5f5f5" >
		<tr>
			<td valign="middle" style="padding:0px 10px 0px 5px;cursor:pointer" 
				onclick="location.href='/'">
<span class="logotext" >Cor<span style='color:#cc6666'>Ex</span></span>
			</td>
END;

	# Note that the first "option" is the welcome text 
	# which does not have menu entry
	$numopts = count($page_opts);
	for($i = 1; $i < $numopts; $i++)
	{
		$option = $page_opts[$i];
		$lbl = $page_lbls[$i];
		#$pg = $page_pgs[$i];
		$link = "/index.html?opt=$option";
		print "\n<td valign='middle' class='headlink' style='padding-left:15px'>\n";
		if ($option == $cur_opt)
		{
			print "<a class='head_selected'>$lbl</a>\n";
		}
		else
		{
			print "<a href='$link' >$lbl</a>\n";
		}
		print "\n</td>\n";
	}

	echo <<<END
		</tr>
	</table>
		</td>
		<td> &nbsp;
		</td>
	</tr>
</table>
END;
}
# We only want to put the background image on the welcome page
$bkgstyle = (isset($_GET["opt"]) ? "" : "background-image:url('splashfade2.png');background-size:cover");
?>

<table cellspacing=0 cellpadding=0 style="margin:auto;height:80%">
	<tr>
		<td colspan=2>
<?php headerbar() ?>
		</td>
	</tr>
	<tr>
		<td style="width:675px;height:100%;border:1px solid #d5d5d5;<?php echo $bkgstyle ?>" valign="top">
<?php load_content_html() ?>
		</td>
		<td style="width:275px;border-right:1px solid #d5d5d5;border-bottom:1px solid #d5d5d5" valign="top">
<div class="side-header">
	News
</div>
<div class="sidebar-inner">
	<ul>
	<li> News
	<li> Dataset stats
	</ul>
</div>
		</td>
	</tr>
	<tr>
		<td colspan=2 align="center" valign="middle" height="50px" style="background-color:#f5f5f5;
				border-left:1px solid #d5d5d5;border-right:1px solid #d5d5d5; border-bottom:1px solid #d5d5d5">
This work supported by GRANTS A,B,C
<br>
We love feedback! <span id="fbem"></span>
		</td>
	</tr>
</table>
<script>
$(document).ready(function() 
{
	setTimeout(function()
	{
		var ema = new Array("g","r","e","g","v","@","i","s","i",".","e","d","u");
		var emaj = ema.join("");
		$("#fbem").html("<a href='mailto:" + emaj + "'>" + emaj + "</a>");

	},100);
});

</script>

<?php

function load_content_html()
{
	$opt = getval("opt","");
	global $page_opts, $page_lbls, $page_pgs;
	for ($i = 1; $i < count($page_opts); $i++)
	{
		if ($page_opts[$i] == $opt)
		{
			require_once($page_pgs[$i]);
			return;
		}	
	}	
	echo "\n<!-- 		PAGE CONTENT START         -->\n";
	require_once($page_pgs[0]);
	echo "\n<!-- 		PAGE CONTENT END         -->\n";
}

?>
